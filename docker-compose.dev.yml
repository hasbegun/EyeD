# Development overrides: hot reload + volume mounts
# Usage: docker compose -f docker-compose.yml -f docker-compose.dev.yml up

services:
  iris-engine:
    volumes:
      - ./iris-engine/src:/app/src:ro
      - ./iris-engine/tests:/app/tests:ro
      - ./iris-engine/pyproject.toml:/app/pyproject.toml:ro
      - ./data:/data:ro
    command: >
      sh -c "pip install --quiet pytest 'httpx>=0.27,<0.28' &&
             uvicorn src.main:app --host 0.0.0.0 --port 7000 --reload"
    environment:
      EYED_LOG_LEVEL: debug
      EYED_DB_URL: postgresql://eyed:eyed_dev@postgres:5432/eyed
      EYED_REDIS_URL: redis://redis:6379/0
      EYED_ENCRYPTION_KEY: ""   # generate: python3 -c "import os; print(os.urandom(32).hex())"
